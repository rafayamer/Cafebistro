<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="mobile-web-app-capable" content="yes" />
<title>Casa Bistro ‚Äì Welcome</title>

<style>
  :root{
    --accent:#004643;
    --text:#f8fafc;
    --muted:#cbd5e1;
    --pad: clamp(12px, 3vw, 24px);
  }

  *{ box-sizing:border-box; margin:0; padding:0; }

  body{
    font-family:system-ui, Segoe UI, Roboto, Arial, sans-serif;
    background:url('bg.jpg') center center / cover no-repeat;
    color:var(--text);
    height:100svh; min-height:100dvh; width:100vw;
    display:flex; align-items:center; justify-content:center;
    overflow:hidden; padding:0;
    -webkit-tap-highlight-color: transparent;
    touch-action: manipulation;
  }

  .overlay,
  .wrap{
    position:fixed; inset:0;
    display:flex; align-items:center; justify-content:center;
    padding:
      calc(var(--pad) + env(safe-area-inset-top))
      calc(var(--pad) + env(safe-area-inset-right))
      calc(var(--pad) + env(safe-area-inset-bottom))
      calc(var(--pad) + env(safe-area-inset-left));
    background:transparent;
    backdrop-filter:none; -webkit-backdrop-filter:none;
    overflow:hidden; transition:opacity .35s ease;
  }
  .overlay{ z-index:100; }
  .wrap{ z-index:90; }
  .overlay.is-hidden{ opacity:0; pointer-events:none; }

  .form-card,
  .card{
    position:relative;
    width:min(520px, 100%);
    background:rgba(255,255,255,.10);
    backdrop-filter:blur(25px) saturate(180%);
    -webkit-backdrop-filter:blur(25px) saturate(180%);
    border:1px solid rgba(255,255,255,.25);
    box-shadow:0 12px 40px rgba(0,0,0,.35);
    border-radius:24px;
    padding:clamp(20px, 5vw, 40px);
    overflow:hidden;
    transform-origin:center top;
  }

  .form-card::before, .card::before{
    content:""; position:absolute; inset:0; border-radius:inherit;
    background:linear-gradient(145deg, rgba(255,255,255,.25), rgba(255,255,255,.05));
    pointer-events:none;
    mask:linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    -webkit-mask-composite:xor; mask-composite:exclude;
  }

  h1, .form-card h2{
    font-size:clamp(20px, 4vw, 28px);
    font-weight:700; text-align:center;
    text-shadow:0 0 12px rgba(0,0,0,.3);
    margin-bottom:10px;
  }
  .form-sub, .sub{
    color:var(--muted);
    font-size:clamp(13px, 2.4vw, 15px);
    margin:0 0 clamp(10px, 3vw, 20px);
    text-align:center;
  }

  .field{ display:grid; gap:8px; margin-bottom:clamp(14px, 3vw, 20px); }
  .label{ font-size:14px; color:#e2e8f0; }

  .input{
    width:100%;
    padding:clamp(12px, 3vw, 16px);
    border-radius:14px;
    border:1px solid rgba(255,255,255,.25);
    background:rgba(0,0,0,.25);
    color:var(--text);
    font-size:clamp(14px, 2.6vw, 16px);
    outline:none; transition:all .2s ease;
  }
  .input:focus{ border-color:var(--accent); box-shadow:0 0 12px rgba(0,70,67,.8); }

  .btn-main, .btn, .cp, .open{
    display:flex; align-items:center; justify-content:center; gap:10px;
    padding:clamp(12px, 3vw, 16px);
    border-radius:14px; border:1px solid rgba(255,255,255,.25);
    background:rgba(0,70,67,.60); color:#fff; font-weight:700;
    text-decoration:none; cursor:pointer; transition:all .3s ease;
    backdrop-filter:blur(14px) saturate(140%); -webkit-backdrop-filter:blur(14px) saturate(140%);
    font-size:clamp(14px, 2.6vw, 16px);
  }

  /* center the Save & Continue button in the form */
  .form-card #submitBtn{
    margin: 12px auto 6px;
    width:max-content;
  }

  /* center the top action buttons */
  .grid{
    display:grid;
    gap:14px;
    justify-items:center;
  }
  .grid .btn{ width:max-content; }

  .btn-main:hover, .btn:hover, .cp:hover, .open:hover{
    box-shadow:0 0 22px rgba(0,70,67,.95); transform:translateY(-2px);
  }

  .wifiBox{
    background:rgba(0,70,67,.35);
    border:1px dashed rgba(255,255,255,.25);
    border-radius:16px; padding:16px; margin-top:16px;
    backdrop-filter:blur(20px) saturate(160%); -webkit-backdrop-filter:blur(20px) saturate(160%);
  }
  .rowx{ display:flex; gap:10px; align-items:center; justify-content:space-between; }
  .pill{
    background:rgba(255,255,255,.08); border-radius:10px; padding:10px 12px;
    font-size:14px; flex:1; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;
  }
  .banner{ background:rgba(0,70,67,.55); border-radius:12px; padding:12px; font-size:13px; margin-top:12px; display:none; }
  .banner.show{ display:block; }
  .hint{ color:#e2e8f0; font-size:13px; margin-top:6px; text-align:center; }

  /* note text inside the card (for "By continuing‚Ä¶") */
  .note{
    color:var(--muted);
    font-size:12.5px;
    text-align:center;
    margin-top:8px;
  }

  .hidden-initial{ visibility:hidden; }

  /* sticky footer at the screen bottom */
  .site-footer{
    position:fixed;
    left:0; right:0;
    bottom:calc(env(safe-area-inset-bottom) + 12px);
    padding:0 var(--pad);
    text-align:center;
    z-index:999;
    font-size:12px;
    color:#e5e7eb;                 /* brighter for visibility */
    text-shadow:0 1px 2px rgba(0,0,0,.7);
    pointer-events:none;
  }
  .site-footer .foot-line{ pointer-events:auto; }
  .site-footer a{
    color:#f8fafc;
    text-decoration:none;
    text-underline-offset:2px;
  }
  .site-footer a:hover{ text-decoration:underline; }
  /* footer pill so text stays readable on bright backgrounds */
  .site-footer .foot-pill{
    display:inline-block;
    padding:8px 14px;
    border-radius:999px;
    background:rgba(17, 24, 39, .78);        /* dark translucent patch */
    color:#fff;
    border:1px solid rgba(255,255,255,.25);   /* subtle rim */
    box-shadow:0 6px 18px rgba(0,0,0,.35);    /* soft drop shadow */
    backdrop-filter:blur(6px) saturate(140%); /* glassy look */
    -webkit-backdrop-filter:blur(6px) saturate(140%);
  }
  .site-footer .foot-pill a{
    color:#fff;                               /* ensure link is white */
    text-decoration:none;
  }
  .site-footer .foot-pill a:hover{ text-decoration:underline; }

  #wifiQR{ width:min(65vw, 200px); height:auto; display:block; margin:10px auto; }

  @media (max-width:600px){
    .form-card, .card{ border-radius:18px; }
  }
</style>
</head>
<body>
<!-- Check-in -->
<div id="checkinOverlay" class="overlay" role="dialog" aria-modal="true">
  <form id="checkinForm" class="form-card" novalidate>
    <h2>Welcome to Casa Bistro üëã</h2>
    <p class="form-sub">Please check in so we can serve you better.</p>

    <div class="field">
      <label class="label" for="name">Full Name</label>
      <input class="input" id="name" name="name" type="text" placeholder="e.g., Ayesha Khan" required minlength="2" maxlength="80" />
    </div>

    <div class="field">
      <label class="label" for="phone">WhatsApp / Phone</label>
      <input class="input" id="phone" name="phone" type="tel" inputmode="tel"
             placeholder="0308 1234567 or +44 7000 111111" required pattern="^[0-9+()\\s-]{8,20}$" />
    </div>

    <div class="err" id="formError"></div>

    <button id="submitBtn" class="btn-main" type="submit">
      <span id="btnText">Save & Continue</span>
      <span id="btnSpinner" aria-hidden="true" style="display:none">‚è≥</span>
    </button>

    <!-- NOTE back inside the front panel -->
    <p class="note">By continuing you agree we may contact you about your visit and offers.</p>
  </form>
</div>

<!-- Main -->
<div id="mainRoot" class="wrap hidden-initial" aria-hidden="true">
  <div class="card">
    <h1>Welcome to Casa Bistro üëã</h1>
    <p class="sub">Choose an option below</p>

    <div class="grid">
      <a id="menuBtn" class="btn" href="casabistro final_compressed.pdf" target="_blank" rel="noopener">üìú Menu</a>
      <button id="wifiBtn" class="btn" type="button">üì∂ Join Wi-Fi</button>
    </div>

    <div id="wifiPanel" class="wifiBox" hidden>
      <div class="rowx">
        <div class="pill" id="ssidText">Casa_Guest</div>
        <button class="cp" id="copySsidBtn" type="button">Copy Name</button>
      </div>

      <div class="rowx" style="margin-top:8px">
        <div class="pill" id="passText">‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢</div>
        <button class="cp" id="copyPassBtn" type="button">Copy Password</button>
      </div>

      <button id="openWifi" class="open" type="button">Open Wi-Fi Settings</button>

      <div id="iosBanner" class="banner">
        <p><b>iPhone/iPad Users:</b> Tap & hold the QR to join Wi-Fi.</p>
        <img id="wifiQR" src="qr.png" alt="Wi-Fi QR" style="display:block;margin:10px auto;width:160px;height:160px;border-radius:12px;background:#fff;padding:6px;">
        <p style="font-size:13px;margin-top:8px;color:#e5e7eb">
          Or manually connect to <b id="ssidInline">Casa_Guest</b> and paste the password you copied.
        </p>
      </div>

      <div class="hint">Tip: If your phone already knows this network, it should reconnect automatically.</div>
    </div> <!-- ‚úÖ CLOSES #wifiPanel -->

    <p class="note">Trouble? Ask staff for help.</p>
  </div> <!-- ‚úÖ .card -->
</div>   <!-- ‚úÖ #mainRoot -->
<script>
/* --- Config --- */
const WIFI_SSID = "Casa_Guest";
const WIFI_PASS = "Pakistan@786";
const MENU_URL  = "casabistro final_compressed.pdf";
const QR_SRC    = "qr.png";
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbx6cLEhny-rkJhSgyBoXul8aqHffh0FpxUPN2V4I9Z-xPcNKfYimJCWttQeBpCwxhqPGg/exec";

/* --- Background save helper (non-blocking) --- */
function postToSheet(payload){
  try{
    fetch(SCRIPT_URL, {
      method: "POST",
      headers: { "Content-Type": "text/plain;charset=utf-8" },
      body: JSON.stringify(payload)
    }).catch(()=>{});
  }catch(e){}
}

/* Optional best-effort public IP fetch (does NOT block UI) */
async function getIP(){
  try{
    const r = await fetch("https://api.ipify.org?format=json",{cache:"no-store"});
    const j = await r.json();
    return (j && j.ip) || "";
  }catch{ return ""; }
}

/* --- Phone normalization to E.164 (PK-first, then global) --- */
function normalizePhone(input){
  if(!input) return null;
  let s = String(input).trim().replace(/[\s\-()]/g,'');
  if (s.startsWith('00')) s = '+' + s.slice(2);
  if (s.startsWith('+')){
    const d = s.slice(1).replace(/\D/g,'');
    return (d.length >= 10 && d.length <= 15) ? ('+' + d) : null;
  }
  const d = s.replace(/\D/g,'');
  if (/^92\d{10}$/.test(d)) return '+' + d;
  if (/^03\d{9}$/.test(d))  return '+92' + d.slice(1);
  if (/^3\d{9}$/.test(d))   return '+92' + d;
  if (/^0\d{9,10}$/.test(d))return '+92' + d.slice(1);
  if (/^[1-9]\d{9,14}$/.test(d)) return '+' + d;
  return null;
}

const CCODES = new Set([
  '1','20','27','30','31','32','33','34','36','39','40','41','43','44','45','46','47','48','49',
  '51','52','53','54','55','56','57','58','60','61','62','63','64','65','66','81','82','84','86',
  '90','91','92','93','94','95','98','211','212','213','216','218','220','221','222','223','224','225','226','227','228','229','230','231',
  '232','233','234','235','236','237','238','239','240','241','242','243','244','245','246','248','249','250','251','252','253','254','255','256',
  '257','258','260','261','262','263','264','265','266','267','268','269','290','291','297','298','299',
  '350','351','352','353','354','355','356','357','358','359',
  '370','371','372','373','374','375','376','377','378','380','381','382','383','385','386','387','389',
  '420','421','423','500','501','502','503','504','505','506','507','508','509',
  '590','591','592','593','594','595','596','597','598','599',
  '670','672','673','674','675','676','677','678','679','680','681','682','683','685','686','687','688','689','690','691','692',
  '850','852','853','855','856','870','871','872','873','874','878','880','881','882','883','886',
  '960','961','962','963','964','965','966','967','968','970','971','972','973','974','975','976','977','978','979',
  '991','992','993','994','995','996','997','998'
]);
function splitE164(e164){
  if(!e164) return { country_code:'', national_number:'' };
  const digits = String(e164).replace(/^\+/, '');
  let cc = '';
  for (let len = 3; len >= 1; len--) {
    const tryCC = digits.slice(0, len);
    if (CCODES.has(tryCC)) { cc = tryCC; break; }
  }
  if (!cc) {
    const m = /^(\d{1,3})(\d{5,})$/.exec(digits);
    return m ? { country_code: '+'+m[1], national_number: m[2] }
             : { country_code: '',       national_number: digits };
  }
  return { country_code: '+' + cc, national_number: digits.slice(cc.length) };
}
function waLink(e164){ return e164 ? "https://wa.me/" + e164.slice(1) : ""; }

/* --- Elements --- */
const overlay   = document.getElementById("checkinOverlay");
const form      = document.getElementById("checkinForm");
const errEl     = document.getElementById("formError");
const mainRoot  = document.getElementById("mainRoot");
const menuBtn   = document.getElementById("menuBtn");
const wifiBtn   = document.getElementById("wifiBtn");
const wifiPanel = document.getElementById("wifiPanel");
const ssidText  = document.getElementById("ssidText");
const passText  = document.getElementById("passText");
const copySsid  = document.getElementById("copySsidBtn");
const copyPass  = document.getElementById("copyPassBtn");
const iosBanner = document.getElementById("iosBanner");
const openWifi  = document.getElementById("openWifi");
const wifiQR    = document.getElementById("wifiQR");

/* --- Setup --- */
menuBtn.href = MENU_URL;
ssidText.textContent = WIFI_SSID;
document.getElementById("ssidInline").textContent = WIFI_SSID;
wifiQR.src = QR_SRC;
passText.textContent = "‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢";

/* Detect iOS (show QR, hide Open Settings) */
const ua = navigator.userAgent || "";
const isIOS = /iPhone|iPad|iPod/i.test(ua) || (navigator.platform === "MacIntel" && navigator.maxTouchPoints > 1);
if (isIOS) { iosBanner.classList.add("show"); openWifi.style.display = "none"; }
else { iosBanner.classList.remove("show"); openWifi.style.display = "inline-flex"; }

/* Android Wi-Fi settings */
openWifi.addEventListener("click", () => {
  try { location.href = "intent:#Intent;action=android.settings.WIFI_SETTINGS;end"; } catch {}
});

/* Toggle Wi-Fi panel */
wifiBtn.addEventListener("click", () => { wifiPanel.hidden = !wifiPanel.hidden; });

/* Copy helpers */
copySsid.onclick = () => navigator.clipboard.writeText(WIFI_SSID).then(()=>alert("SSID copied!"));
copyPass.onclick = () => navigator.clipboard.writeText(WIFI_PASS).then(()=>alert("Password copied!"));

/* Form -> normalize -> background save (with IP) -> reveal main immediately */
form.addEventListener("submit", (e) => {
  e.preventDefault();
  const name      = form.name.value.trim();
  const phoneRaw  = form.phone.value.trim();
  const phoneE164 = normalizePhone(phoneRaw);

  if (!name || name.length < 2) { errEl.textContent = "Please enter your full name."; return; }
  if (!phoneE164) { errEl.textContent = "Please add a valid phone number (include country code if not Pakistani)."; return; }

  const split = splitE164(phoneE164);

  getIP().then(ip => {
    postToSheet({
      name,
      phone: phoneE164,
      country_code: split.country_code,
      national_number: split.national_number,
      phone_raw: phoneRaw,
      whatsapp: waLink(phoneE164),
      ip: ip || ""
    });
  });

  overlay.classList.add('is-hidden');
  setTimeout(() => {
    overlay.style.display = "none";
    mainRoot.classList.remove("hidden-initial");
    mainRoot.setAttribute("aria-hidden","false");
  }, 350);
});

/* ---------- Auto-fit for phones (no heavy observers; debounced) ---------- */
(function(){
  const $ = (s,p=document)=>p.querySelector(s);
  let raf = 0;
  let metaFixed = false;

  function availH(container){
    const vv = window.visualViewport ? visualViewport.height : window.innerHeight;
    const cs = getComputedStyle(container);
    return vv - parseFloat(cs.paddingTop||0) - parseFloat(cs.paddingBottom||0);
  }
  function scaleToFit(el, container){
    if(!el || !container) return;
    el.style.transform = 'scale(1)';
    const h = el.getBoundingClientRect().height;
    const s = Math.min(1, (availH(container) - 2) / h);
    el.style.transformOrigin = 'center top';
    el.style.transform = `scale(${s})`;
  }
  function isPhone(){ return /iPhone|iPod|Android/i.test(navigator.userAgent); }
  function desktopModeOnPhone(){
    const vw = (window.visualViewport ? visualViewport.width : window.innerWidth);
    const sw = screen.width || vw;
    return isPhone() && vw > sw + 40;
  }
  function fitAll(){
    scaleToFit($('#checkinForm'), $('#checkinOverlay'));
    scaleToFit($('#mainRoot .card'), $('#mainRoot'));
  }
  function scheduleFit(){ cancelAnimationFrame(raf); raf = requestAnimationFrame(fitAll); }
  function ensureViewportOnce(){
    if (!metaFixed && desktopModeOnPhone()){
      let meta = document.querySelector('meta[name=viewport]');
      if (!meta){
        meta = document.createElement('meta');
        meta.name = 'viewport';
        document.head.appendChild(meta);
      }
      meta.content = 'width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover';
      metaFixed = true;
    }
    scheduleFit();
  }

  window.addEventListener('load', ensureViewportOnce, {passive:true});
  window.addEventListener('resize', scheduleFit, {passive:true});
  window.addEventListener('orientationchange', scheduleFit, {passive:true});
  if (window.visualViewport){
    visualViewport.addEventListener('resize', scheduleFit, {passive:true});
    visualViewport.addEventListener('scroll', scheduleFit, {passive:true});
  }
})();
</script>

<footer class="site-footer" aria-label="Site footer">
  <div class="foot-line">
    <span class="foot-pill">
      Powered By <a href="https://cubeprogramming.com/" target="_blank" rel="noopener">Cube Programming</a>
    </span>
  </div>
</footer>


</body>
</html>
