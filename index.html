<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Casa Bistro ‚Äì Welcome</title>
<style>
  :root {
    --bg-overlay: rgba(0,0,0,0.55);
    --card-bg: rgba(17,24,39,0.78);
    --text:#f8fafc;
    --muted:#cbd5e1;
    --btn2:#0ea5e9;
    --accent:#22c55e;
  }
  *{box-sizing:border-box;margin:0;padding:0}
  body{
    font-family:system-ui,Segoe UI,Roboto,Arial;
    background:url('background.jpg') center center/cover no-repeat fixed;
    color:var(--text);
    min-height:100vh;
    overflow-x:hidden;
  }
  body::before{
    content:"";
    position:fixed;
    inset:0;
    background:linear-gradient(160deg,var(--bg-overlay),rgba(15,23,42,0.85));
    backdrop-filter:blur(2px);
    z-index:-1;
  }

  /* Overlay form */
  .overlay{
    position:fixed;inset:0;display:grid;place-items:center;
    background:rgba(15,23,42,0.75);backdrop-filter:blur(8px);
    z-index:50;
  }
  .form-card{
    width:100%;max-width:520px;background:var(--card-bg);
    color:var(--text);border-radius:20px;padding:26px;
    box-shadow:0 10px 40px rgba(0,0,0,.55);
  }
  .form-card h2{margin:0 0 6px;font-size:24px;font-weight:700;}
  .form-sub{color:var(--muted);font-size:14px;margin:0 0 16px}
  .field{display:grid;gap:6px;margin-bottom:12px}
  .label{font-size:14px;color:#e2e8f0}
  .input{
    width:100%;padding:12px 14px;border-radius:12px;
    border:1px solid rgba(255,255,255,0.15);
    background:rgba(0,0,0,0.25);color:var(--text);font-size:16px;outline:none;
  }
  .input::placeholder{color:#94a3b8}
  .btn-main{
    display:inline-flex;align-items:center;justify-content:center;gap:10px;
    padding:12px 16px;border:0;border-radius:12px;
    background:var(--btn2);color:white;font-weight:700;width:100%;cursor:pointer;
    transition:all .2s ease;
  }
  .btn-main:hover{background:#38bdf8;transform:translateY(-1px);}
  .btn-main[disabled]{opacity:.6;cursor:not-allowed}
  .err{color:#fecaca;font-size:13px;min-height:18px;margin-top:6px}
  .note{color:var(--muted);font-size:12px;margin-top:8px;text-align:center;}

  /* Main page */
  .wrap{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:24px;}
  .card{
    width:100%;max-width:520px;
    background:var(--card-bg);border-radius:20px;padding:24px;
    box-shadow:0 10px 40px rgba(0,0,0,.55);backdrop-filter:blur(10px);
  }
  h1{color:var(--text);font-size:24px;margin:0 0 8px}
  .sub{color:var(--muted);font-size:15px;margin:0 0 18px}
  .grid{display:grid;gap:12px}
  .btn{
    display:flex;align-items:center;justify-content:center;gap:10px;
    padding:16px 18px;border:0;border-radius:14px;
    background:rgba(0,0,0,0.4);color:var(--text);
    font-size:18px;font-weight:600;text-decoration:none;transition:all .2s ease;
  }
  .btn:hover{background:rgba(255,255,255,0.15);}
  .btn.menu{background:var(--btn2);}
  .btn.wifi{background:#6366f1;}
  .small{font-size:12px;color:var(--muted);margin-top:10px;text-align:center}
  .wifiBox{background:rgba(0,0,0,0.25);border:1px dashed rgba(255,255,255,0.2);border-radius:14px;padding:14px;margin-top:14px}
  .rowx{display:flex;gap:10px;align-items:center;justify-content:space-between}
  .pill{background:rgba(255,255,255,0.1);border-radius:10px;padding:10px 12px;font-size:14px;flex:1;}
  .cp{padding:10px 12px;border-radius:10px;background:var(--btn2);color:white;border:0;font-weight:700;cursor:pointer;}
  .open{margin-top:10px;background:#22c55e;}
  .banner{background:rgba(0,0,0,0.4);border-radius:10px;padding:10px 12px;font-size:13px;margin-top:10px;display:none}
  .banner.show{display:block}
  .hint{color:#e2e8f0;font-size:13px}
  .hidden-initial{visibility:hidden}
</style>
</head>
<body>

<!-- ===== Check-in Overlay ===== -->
<div id="checkinOverlay" class="overlay" role="dialog" aria-modal="true">
  <form id="checkinForm" class="form-card" novalidate>
    <h2>Welcome to Casa Bistro üëã</h2>
    <p class="form-sub">Please check in so we can serve you better.</p>
    <input type="text" name="website" autocomplete="off" tabindex="-1" style="position:absolute;left:-9999px;opacity:0" aria-hidden="true" />

    <div class="field">
      <label class="label" for="name">Full Name</label>
      <input class="input" id="name" name="name" type="text" placeholder="e.g., Ayesha Khan" required minlength="2" maxlength="80" />
    </div>

    <div class="field">
      <label class="label" for="phone">WhatsApp / Phone</label>
      <input class="input" id="phone" name="phone" type="tel" inputmode="tel"
             placeholder="0308 1234567 or +44 7000 111111" required pattern="^[0-9+()\s-]{8,20}$" />
    </div>

    <div class="err" id="formError"></div>
    <button id="submitBtn" class="btn-main" type="submit">
      <span id="btnText">Save & Continue</span>
      <span id="btnSpinner" aria-hidden="true" style="display:none">‚è≥</span>
    </button>
    <p class="note">By continuing you agree we may contact you about your visit and offers.</p>
  </form>
</div>

<!-- ===== Main Page ===== -->
<div id="mainRoot" class="wrap hidden-initial" aria-hidden="true">
  <div class="card">
    <h1>Welcome to Casa Bistro üëã</h1>
    <p class="sub">Choose an option below</p>

    <div class="grid">
      <a id="menuBtn" class="btn menu" href="#" target="_blank" rel="noopener"><span class="icons">üìú</span> Menu</a>
      <button id="wifiBtn" class="btn wifi" type="button"><span class="icons">üì∂</span> Join Wi-Fi</button>
    </div>

    <div id="wifiPanel" class="wifiBox" hidden>
      <div class="rowx">
        <div class="pill" id="ssidText">SSID</div>
        <button class="cp" id="copySsidBtn" type="button">Copy Name</button>
      </div>
      <div class="rowx" style="margin-top:8px">
        <div class="pill" id="passText">‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢</div>
        <button class="cp" id="copyPassBtn" type="button">Copy Password</button>
      </div>
      <button id="openWifi" class="cp open" type="button">Open Wi-Fi Settings</button>

      <div id="iosBanner" class="banner">
        <p><b>iPhone/iPad Users:</b> Click & hold QR code to join Wi-Fi.</p>
        <img id="wifiQR" src="qr.png" alt="Casa Bistro Wi-Fi QR"
             style="display:block;margin:10px auto;width:160px;height:160px;border-radius:12px;background:#fff;padding:6px;">
        <p style="font-size:13px;margin-top:8px;color:#e5e7eb">
          Or manually connect to <b id="ssidInline"></b> and paste the password you copied.
        </p>
      </div>

      <div class="hint">Tip: If your phone already knows this network, it should reconnect automatically.</div>
    </div>
    <p class="small">Trouble? Ask staff for help.</p>
  </div>
</div>

<script>
/* ========= CONFIG ========= */
const WIFI_SSID = "Casa_Guest";
const WIFI_PASS = "Pakistan@786";
const MENU_URL  = "casabistro final_compressed.pdf";  // Local PDF menu
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwW7wtqtaFsBuGnDbNdcNIT5b7fGmuz0sQpndpMgXUYL6fQWlif1evi-5g9Fx3TavkjBg/exec";
/* ========================= */
const $ = id => document.getElementById(id);

/* ===== UI Bindings ===== */
$("menuBtn").href = MENU_URL;
$("ssidText").textContent = WIFI_SSID;
$("ssidInline").textContent = WIFI_SSID;

/* ===== Wi-Fi Logic ===== */
const passEl = $("passText");
const mask = s => s.replace(/./g,"‚Ä¢");
passEl.textContent = mask(WIFI_PASS);
let t;
function show(){passEl.textContent=WIFI_PASS}
function hide(){passEl.textContent=mask(WIFI_PASS)}
["mousedown","touchstart"].forEach(e=>passEl.addEventListener(e,()=>{clearTimeout(t);t=setTimeout(show,100);}));
["mouseup","mouseleave","touchend","touchcancel"].forEach(e=>passEl.addEventListener(e,()=>{clearTimeout(t);hide();}));
async function copyText(text){try{await navigator.clipboard.writeText(text);alert("Copied!");}catch{alert("Copy failed. Try manually.");}}
$("copySsidBtn").onclick=()=>copyText(WIFI_SSID);
$("copyPassBtn").onclick=()=>copyText(WIFI_PASS);

const ua=navigator.userAgent||"";
const isAndroid=/Android/i.test(ua);
const isIOS=/iPhone|iPad|iPod/i.test(ua);
$("wifiBtn").onclick=()=>{$("wifiPanel").hidden=false;if(isIOS){$("iosBanner").classList.add("show");$("openWifi").hidden=true;}else{$("openWifi").hidden=false;}}
$("openWifi").onclick=()=>{if(isAndroid){location.href="intent:#Intent;action=android.settings.WIFI_SETTINGS;end";}else{$("iosBanner").classList.add("show");}};

/* ===== Check-in Logic ===== */
const overlay=$("checkinOverlay");
const form=$("checkinForm");
const errEl=$("formError");
const btn=$("submitBtn");
const btnText=$("btnText");
const btnSpin=$("btnSpinner");
const mainRoot=$("mainRoot");

function revealMain(){overlay.style.display="none";mainRoot.style.visibility="visible";mainRoot.setAttribute("aria-hidden","false");}
function setBusy(b){btn.disabled=b;btnSpin.style.display=b?"inline-block":"none";btnText.textContent=b?"Saving...":"Save & Continue";}
function showError(m){errEl.textContent=m||"";}
function normalizePhone(i){if(!i)return null;let n=i.replace(/[^\d+]/g,"");if(n.startsWith("00"))n="+"+n.slice(2);if(/^0\d{10}$/.test(n))n="+92"+n.slice(1);else if(/^3\d{9}$/.test(n))n="+92"+n;if(!/^\+\d{10,15}$/.test(n))return null;return n;}
function whatsappLink(num){return num?"https://wa.me/"+num.replace("+",""):"";}
async function postToSheet(payload){try{await fetch(SCRIPT_URL,{method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify(payload)});}catch(e){console.error(e);}}

form.addEventListener("submit",(e)=>{
  e.preventDefault();showError("");
  const name=form.name.value.trim();
  let phone=form.phone.value.trim();
  if(!name||name.length<2){showError("Please enter your full name.");return;}
  if(!phone){showError("Please enter your phone number.");return;}
  phone=normalizePhone(phone);if(!phone){showError("Invalid phone number.");return;}
  const payload={name,phone,whatsapp:whatsappLink(phone),userAgent:navigator.userAgent,referrer:document.referrer||""};
  postToSheet(payload); // background save
  revealMain();
});
</script>
</body>
</html>
